<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wheelchair Maintenance Reminder</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="https://favicon.io/favicon.ico">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Wheelchair Reminder">
</head>
<body>
  <button class="admin-login" onclick="adminLogin()">Admin Login</button>
  <div class="container">
    <h1>Wheelchair Maintenance Reminder</h1>
    <div id="selection-primary-card" class="card">
      <h2>Select Primary Equipment</h2>
      <table>
        <tr><td colspan="2"><select id="primary-equipment" class="select"><option value="">Select one</option><option value="Rigid Ultra-Light Manual Wheelchair">Rigid Ultra-Light Manual Wheelchair</option><option value="Folding Ultra-Light Manual Wheelchair">Folding Ultra-Light Manual Wheelchair</option><option value="Power Wheelchair with Power Seating Functions">Power Wheelchair with Power Seating Functions</option><option value="Power Wheelchair without Power Seating Functions">Power Wheelchair without Power Seating Functions</option></select></td></tr>
      </table>
      <div class="nav-buttons">
        <button id="back-button" class="button hidden">Back</button>
        <button id="next-to-power" class="button">Next</button>
        <button id="return-to-home" class="button">Return to Home</button>
      </div>
      <div class="since-date" id="since-date"></div>
    </div>
    <div id="selection-power-card" class="card hidden">
      <h2>Select Power Assist</h2>
      <table>
        <tr><th colspan="2" class="label">Optional Power Assist (Select one or both)</th></tr>
        <tr><td><label><input type="checkbox" id="detachable-power-assist" value="Detachable Power Assist"> Detachable Power Assist</label></td><td><label><input type="checkbox" id="hand-rim-power-assist" value="Hand-Rim Activated Power Assist"> Hand-Rim Activated Power Assist</label></td></tr>
      </table>
      <div class="nav-buttons">
        <button id="back-button" class="button">Back</button>
        <button id="next-to-seat" class="button">Next</button>
        <button id="return-to-home" class="button">Return to Home</button>
      </div>
      <div class="since-date" id="since-date"></div>
    </div>
    <div id="selection-seat-card" class="card hidden">
      <h2>Select Seat Cushions</h2>
      <table>
        <tr><th colspan="2" class="label">Select Seat Cushion(s) (One or more)</th></tr>
        <tr><td><label><input type="checkbox" id="air-seat" value="Air Seat Cushion"> Air Seat Cushion</label></td><td><label><input type="checkbox" id="foam-seat" value="Foam Seat Cushion"> Foam Seat Cushion</label></td></tr>
        <tr><td><label><input type="checkbox" id="gel-seat" value="Gel Seat Cushion"> Gel Seat Cushion</label></td><td></td></tr>
      </table>
      <div class="nav-buttons">
        <button id="back-button" class="button">Back</button>
        <button id="next-to-backrest" class="button">Next</button>
        <button id="return-to-home" class="button">Return to Home</button>
      </div>
      <div class="since-date" id="since-date"></div>
    </div>
    <div id="selection-backrest-card" class="card hidden">
      <h2>Select Backrest Cushions</h2>
      <table>
        <tr><th colspan="2" class="label">Select Backrest Cushion(s) (One or more)</th></tr>
        <tr><td><label><input type="checkbox" id="air-backrest" value="Air Backrest Cushion"> Air Backrest Cushion</label></td><td><label><input type="checkbox" id="foam-backrest" value="Foam Backrest Cushion"> Foam Backrest Cushion</label></td></tr>
        <tr><td><label><input type="checkbox" id="gel-backrest" value="Gel Backrest Cushion"> Gel Backrest Cushion</label></td><td></td></tr>
      </table>
      <div class="nav-buttons">
        <button id="back-button" class="button">Back</button>
        <button id="next-to-contact" class="button">Next: Enter Contact Info</button>
        <button id="return-to-home" class="button">Return to Home</button>
      </div>
      <div class="since-date" id="since-date"></div>
    </div>
    <div id="contact-card" class="card hidden">
      <h2>Contact Information</h2>
      <form id="contact-form">
        <div class="label">Wheelchair Vendor</div>
        <input type="text" id="vendor-company" placeholder="Company Name" required>
        <input type="text" id="vendor-rep" placeholder="Representative Name" required>
        <input type="tel" id="vendor-phone" placeholder="Phone Number" required>
        <div class="label">Clinical Therapist</div>
        <input type="text" id="therapist-hospital" placeholder="Hospital/Clinic Name" required>
        <input type="text" id="therapist-name" placeholder="Therapist Name" required>
        <input type="tel" id="therapist-phone" placeholder="Phone Number" required>
        <input type="email" id="therapist-email" placeholder="Email" required>
      </form>
      <div class="nav-buttons">
        <button id="back-button" class="button">Back</button>
        <button id="submit-contact" class="button">Submit</button>
        <button id="return-to-home" class="button">Return to Home</button>
      </div>
      <div class="since-date" id="since-date"></div>
    </div>
    <div id="profile-card" class="card">
      <h2>My Mobility Equipment</h2>
      <ul id="profile-list"></ul>
      <div class="profile-link" onclick="editContacts()">Edit Contact Information</div>
      <div class="profile-link" onclick="editProfile()">Edit My Mobility Equipment Profile</div>
      <div class="nav-buttons">
        <button id="back-button" class="button hidden">Back</button>
        <button id="return-to-home" class="button hidden">Return to Home</button>
      </div>
      <button id="turn-off-reminders-profile" class="turn-off-button">Turn Off My Reminders</button>
      <button id="turn-on-reminders-profile" class="turn-on-button">Turn On My Reminders</button>
      <div class="reminder-status" id="reminder-status">Reminders: ❌ OFF</div>
      <div class="since-date" id="since-date"></div>
    </div>
    <div id="reminders" class="reminders hidden">
      <h2>Scheduled Reminders</h2>
      <ul id="reminder-list"></ul>
      <div class="nav-buttons">
        <button id="back-button" class="button">Back</button>
        <button id="return-to-home-reminders" class="button">Return to Home</button>
      </div>
      <div class="since-date" id="since-date"></div>
    </div>
    <div id="admin-data" class="hidden">
      <h3>Admin Statistics</h3>
      <p>Mobility Base: <span id="mobility-base-count"></span></p>
      <p>Backrest Cushion: <span id="backrest-count"></span></p>
      <p>Seat Cushion: <span id="seat-count"></span></p>
      <p>Total Users: <span id="user-count">0</span></p>
      <p>Users with Reminders: <span id="reminder-count">0</span></p>
      <p>Users with Reminders Disabled: <span id="disable-count">0</span></p>
    </div>
    <div id="error" class="error" style="display: none;"></div>
  </div>
  <script>
    const MAINTENANCE_SCHEDULES = {
      "Rigid Ultra-Light Manual Wheelchair": { label: "Rigid Ultra-Light Manual Wheelchair", task: "Check camber plug clamps", redFlag: "Contact vendor if loose" },
      "Folding Ultra-Light Manual Wheelchair": { label: "Folding Ultra-Light Manual Wheelchair", task: "Check folding mechanism", redFlag: "Contact vendor if sticks" },
      "Hand-Rim Activated Power Assist": { label: "Hand-Rim Activated Power Assist", task: "Check battery capacity", redFlag: "Contact dealer if fails" },
      "Detachable Power Assist": { label: "Detachable Power Assist", task: "Inspect components", redFlag: "Contact dealer if damaged" },
      "Power Wheelchair with Power Seating Functions": { label: "Power Wheelchair with Power Seating Functions", task: "Check battery level", redFlag: "Contact vendor if fails" },
      "Power Wheelchair without Power Seating Functions": { label: "Power Wheelchair without Power Seating Functions", task: "Check tires", redFlag: "Contact vendor if pressure drops" },
      "Air Backrest Cushion": { label: "Air Backrest Cushion", task: "Check air inserts", redFlag: "Contact vendor if leaks" },
      "Foam Backrest Cushion": { label: "Foam Backrest Cushion", task: "Inspect foam pad", redFlag: "Contact vendor if degraded" },
      "Gel Backrest Cushion": { label: "Gel Backrest Cushion", task: "Inspect gel pad", redFlag: "Contact vendor if degraded" },
      "Air Seat Cushion": { label: "Air Seat Cushion", task: "Check air cells", redFlag: "Contact vendor if punctures" },
      "Foam Seat Cushion": { label: "Foam Seat Cushion", task: "Inspect foam", redFlag: "Contact vendor if degraded" },
      "Gel Seat Cushion": { label: "Gel Seat Cushion", task: "Inspect fluid pad", redFlag: "Contact vendor if leaks" }
    };

    let selectedComponents = [];
    let profileId = localStorage.getItem("profileId");
    let contacts = { vendor: {}, therapist: {} };
    let userCount = parseInt(localStorage.getItem("userCount") || "0");
    let reminderCount = parseInt(localStorage.getItem("reminderCount") || "0");
    let disableCount = parseInt(localStorage.getItem("disableCount") || "0");
    let mobilityBaseCount = JSON.parse(localStorage.getItem("mobilityBaseCount") || '{"n/a": 0, "Rigid Ultra-Light Manual Wheelchair": 0, "Folding Ultra-Light Manual Wheelchair": 0, "Power Wheelchair with Power Seating Functions": 0, "Power Wheelchair without Power Seating Functions": 0, "Hand-Rim Activated Power Assist": 0, "Detachable Power Assist": 0}');
    let backrestCount = JSON.parse(localStorage.getItem("backrestCount") || '{"n/a": 0, "Air Backrest Cushion": 0, "Foam Backrest Cushion": 0, "Gel Backrest Cushion": 0}');
    let seatCount = JSON.parse(localStorage.getItem("seatCount") || '{"n/a": 0, "Air Seat Cushion": 0, "Foam Seat Cushion": 0, "Gel Seat Cushion": 0}');
    let startDate = localStorage.getItem(`startDate_${profileId}`) || new Date().toLocaleDateString();
    let navigationHistory = [];
    let remindersEnabled = localStorage.getItem(`remindersEnabled_${profileId}`) !== "false";

    // Initialize or load profile using IP address and update counters
    async function initializeProfile() {
      if (!profileId) {
        try {
          const response = await fetch("https://api.ipify.org?format=json");
          const data = await response.json();
          profileId = data.ip;
          localStorage.setItem("profileId", profileId);
          userCount++;
          localStorage.setItem("userCount", userCount);
          document.getElementById("user-count").textContent = userCount;
          localStorage.setItem(`startDate_${profileId}`, startDate);
          localStorage.setItem(`remindersEnabled_${profileId}`, "true");
        } catch (error) {
          console.error("Failed to fetch IP:", error);
          profileId = "default-" + Date.now();
          localStorage.setItem("profileId", profileId);
          userCount++;
          localStorage.setItem("userCount", userCount);
          document.getElementById("user-count").textContent = userCount;
          localStorage.setItem(`startDate_${profileId}`, startDate);
          localStorage.setItem(`remindersEnabled_${profileId}`, "true");
        }
        localStorage.setItem(`profile_${profileId}`, JSON.stringify([]));
        localStorage.setItem(`contacts_${profileId}`, JSON.stringify({ vendor: {}, therapist: {} }));
      }
      loadProfile();
      updateAdminStats();
      updateSinceDate();
      updateReminderStatus();
    }

    function updateSinceDate() {
      const sinceDateElements = document.querySelectorAll("#since-date");
      sinceDateElements.forEach(el => el.textContent = `Maintaining my equipment since ${startDate}`);
    }

    function loadProfile() {
      if (profileId) {
        const savedComponents = JSON.parse(localStorage.getItem(`profile_${profileId}`) || "[]");
        const savedContacts = JSON.parse(localStorage.getItem(`contacts_${profileId}`) || "{}");
        contacts = savedContacts;
        selectedComponents = savedComponents;
        if (savedComponents.length > 0) {
          document.getElementById("selection-primary-card").classList.add("hidden");
          document.getElementById("selection-power-card").classList.add("hidden");
          document.getElementById("selection-seat-card").classList.add("hidden");
          document.getElementById("selection-backrest-card").classList.add("hidden");
          document.getElementById("contact-card").classList.add("hidden");
          document.getElementById("reminders").classList.add("hidden");
          document.getElementById("profile-card").classList.remove("hidden");
          const profileList = document.getElementById("profile-list");
          profileList.innerHTML = savedComponents.map(comp => `<li>${MAINTENANCE_SCHEDULES[comp].label}</li>`).join("");
          updateReminderList();
          updateContactDisplay();
          navigationHistory = ["profile-card"];
        } else {
          navigationHistory = ["selection-primary-card"];
        }
        updateNavButtons();
      }
    }

    function updateContactDisplay() {
      if (contacts.vendor.company) {
        document.getElementById("profile-list").innerHTML += `<li>Vendor: ${contacts.vendor.company}, ${contacts.vendor.rep}, ${contacts.vendor.phone}</li>`;
      }
      if (contacts.therapist.name) {
        document.getElementById("profile-list").innerHTML += `<li>Therapist: ${contacts.therapist.name}, ${contacts.therapist.phone}, ${contacts.therapist.email} (${contacts.therapist.hospital})</li>`;
      }
    }

    function editProfile() {
      document.getElementById("profile-card").classList.add("hidden");
      document.getElementById("selection-primary-card").classList.remove("hidden");
      navigationHistory.push("selection-primary-card");
      selectedComponents = JSON.parse(localStorage.getItem(`profile_${profileId}`) || "[]");
      if (selectedComponents.length > 0) {
        document.getElementById("primary-equipment").value = selectedComponents.find(comp => Object.keys(MAINTENANCE_SCHEDULES).includes(comp));
        ["detachable-power-assist", "hand-rim-power-assist", "air-seat", "foam-seat", "gel-seat", "air-backrest", "foam-backrest", "gel-backrest"].forEach(id => {
          document.getElementById(id).checked = selectedComponents.includes(MAINTENANCE_SCHEDULES[id.replace("-", " ")].label);
        });
      }
      updateNavButtons();
      localStorage.setItem(`profile_${profileId}`, JSON.stringify(selectedComponents));
    }

    function editContacts() {
      document.getElementById("profile-card").classList.add("hidden");
      document.getElementById("contact-card").classList.remove("hidden");
      navigationHistory.push("contact-card");
      const savedContacts = JSON.parse(localStorage.getItem(`contacts_${profileId}`) || "{}");
      if (savedContacts.vendor.company) {
        document.getElementById("vendor-company").value = savedContacts.vendor.company;
        document.getElementById("vendor-rep").value = savedContacts.vendor.rep;
        document.getElementById("vendor-phone").value = savedContacts.vendor.phone;
      }
      if (savedContacts.therapist.name) {
        document.getElementById("therapist-hospital").value = savedContacts.therapist.hospital;
        document.getElementById("therapist-name").value = savedContacts.therapist.name;
        document.getElementById("therapist-phone").value = savedContacts.therapist.phone;
        document.getElementById("therapist-email").value = savedContacts.therapist.email;
      }
      updateNavButtons();
      localStorage.setItem(`contacts_${profileId}`, JSON.stringify(contacts));
    }

    function updateReminderList() {
      const reminderList = document.getElementById("reminder-list");
      reminderList.innerHTML = "";
      selectedComponents.forEach(component => {
        const schedule = MAINTENANCE_SCHEDULES[component];
        Object.entries(MAINTENANCE_SCHEDULES).forEach(([key, { label }]) => {
          if (key === component) {
            const li = document.createElement("li");
            li.textContent = `Reminder set for ${label}`;
            reminderList.appendChild(li);
          }
        });
      });
    }

    function nextSection(currentCardId, nextCardId) {
      try {
        if (currentCardId === "selection-primary-card") {
          const primaryEquipment = document.getElementById("primary-equipment").value || null;
          if (primaryEquipment) selectedComponents = [primaryEquipment];
        } else if (currentCardId === "selection-power-card") {
          const detachablePowerAssist = document.getElementById("detachable-power-assist").checked ? "Detachable Power Assist" : null;
          const handRimPowerAssist = document.getElementById("hand-rim-power-assist").checked ? "Hand-Rim Activated Power Assist" : null;
          if (detachablePowerAssist) selectedComponents.push(detachablePowerAssist);
          if (handRimPowerAssist) selectedComponents.push(handRimPowerAssist);
        } else if (currentCardId === "selection-seat-card") {
          ["air-seat", "foam-seat", "gel-seat"].forEach(id => {
            if (document.getElementById(id).checked) selectedComponents.push(document.getElementById(id).value);
          });
        } else if (currentCardId === "selection-backrest-card") {
          ["air-backrest", "foam-backrest", "gel-backrest"].forEach(id => {
            if (document.getElementById(id).checked) selectedComponents.push(document.getElementById(id).value);
          });
        }
        document.getElementById(currentCardId).classList.add("hidden");
        document.getElementById(nextCardId).classList.remove("hidden");
        navigationHistory.push(nextCardId);
        if (profileId) {
          localStorage.setItem(`profile_${profileId}`, JSON.stringify(selectedComponents));
          // Update category counts
          Object.keys(mobilityBaseCount).forEach(key => mobilityBaseCount[key] = 0);
          Object.keys(backrestCount).forEach(key => backrestCount[key] = 0);
          Object.keys(seatCount).forEach(key => seatCount[key] = 0);
          selectedComponents.forEach(comp => {
            if (["Rigid Ultra-Light Manual Wheelchair", "Folding Ultra-Light Manual Wheelchair", "Power Wheelchair with Power Seating Functions", "Power Wheelchair without Power Seating Functions", "Hand-Rim Activated Power Assist", "Detachable Power Assist"].includes(comp)) {
              mobilityBaseCount[comp] = (mobilityBaseCount[comp] || 0) + 1;
            } else if (comp.includes("Backrest")) {
              backrestCount[comp] = (backrestCount[comp] || 0) + 1;
            } else if (comp.includes("Seat")) {
              seatCount[comp] = (seatCount[comp] || 0) + 1;
            }
          });
          localStorage.setItem("mobilityBaseCount", JSON.stringify(mobilityBaseCount));
          localStorage.setItem("backrestCount", JSON.stringify(backrestCount));
          localStorage.setItem("seatCount", JSON.stringify(seatCount));
        }
        updateNavButtons();
      } catch (error) {
        console.error("Error advancing section:", error);
        document.getElementById("error").textContent = `An error occurred. Check the console for details: ${error.message}`;
        document.getElementById("error").style.display = "block";
      }
    }

    function submitContact() {
      try {
        contacts.vendor = {
          company: document.getElementById("vendor-company").value,
          rep: document.getElementById("vendor-rep").value,
          phone: document.getElementById("vendor-phone").value
        };
        contacts.therapist = {
          hospital: document.getElementById("therapist-hospital").value,
          name: document.getElementById("therapist-name").value,
          phone: document.getElementById("therapist-phone").value,
          email: document.getElementById("therapist-email").value
        };
        document.getElementById("selection-primary-card").classList.add("hidden");
        document.getElementById("selection-power-card").classList.add("hidden");
        document.getElementById("selection-seat-card").classList.add("hidden");
        document.getElementById("selection-backrest-card").classList.add("hidden");
        document.getElementById("contact-card").classList.add("hidden");
        document.getElementById("reminders").classList.remove("hidden");
        if (profileId) {
          localStorage.setItem(`contacts_${profileId}`, JSON.stringify(contacts));
          reminderCount++;
          localStorage.setItem("reminderCount", reminderCount);
          document.getElementById("reminder-count").textContent = reminderCount;
        }
      } catch (error) {
        console.error("Error submitting contact:", error);
        document.getElementById("error").textContent = `An error occurred. Check the console for details: ${error.message}`;
        document.getElementById("error").style.display = "block";
      }
    }

    function submitReminders() {
      try {
        const reminderList = document.getElementById("reminder-list");
        reminderList.innerHTML = "";
        selectedComponents.forEach(component => {
          const schedule = MAINTENANCE_SCHEDULES[component];
          Object.entries(MAINTENANCE_SCHEDULES).forEach(([key, { label }]) => {
            if (key === component) {
              const li = document.createElement("li");
              li.textContent = `Reminder set for ${label}`;
              reminderList.appendChild(li);
            }
          });
        });

        document.getElementById("reminders").classList.remove("hidden");
        document.getElementById("selection-primary-card").classList.add("hidden");
        document.getElementById("selection-power-card").classList.add("hidden");
        document.getElementById("selection-seat-card").classList.add("hidden");
        document.getElementById("selection-backrest-card").classList.add("hidden");
        document.getElementById("contact-card").classList.add("hidden");
        goHome(); // Redirect to profile after reminders

        if (typeof Notification !== "undefined" && Notification.permission !== "granted" && remindersEnabled) {
          Notification.requestPermission().then(permission => {
            if (permission === "granted") {
              sendNotifications();
            } else {
              alert("Notifications are disabled. Please enable them in browser settings.");
            }
          });
        } else if (Notification.permission === "granted" && remindersEnabled) {
          sendNotifications();
        } else {
          alert("This browser does not support notifications or reminders are off.");
        }
      } catch (error) {
        console.error("Error submitting reminders:", error);
        document.getElementById("error").textContent = `An error occurred. Check the console for details: ${error.message}`;
        document.getElementById("error").style.display = "block";
      }
    }

    function sendNotifications() {
      if (remindersEnabled) {
        selectedComponents.forEach(component => {
          const schedule = MAINTENANCE_SCHEDULES[component];
          Object.entries(MAINTENANCE_SCHEDULES).forEach(([key, { label, task, redFlag }]) => {
            if (key === component && task) {
              let body = `${label} - ${redFlag}`;
              if (redFlag.includes("Contact vendor") && contacts.vendor.phone) {
                body += `; Vendor: ${contacts.vendor.company}, ${contacts.vendor.rep}, ${contacts.vendor.phone}`;
              } else if (redFlag.includes("Contact dealer") && contacts.therapist.phone) {
                body += `; Therapist: ${contacts.therapist.name}, ${contacts.therapist.phone}, ${contacts.therapist.email} (${contacts.therapist.hospital})`;
              }
              new Notification(`Reminder: ${task}`, { body });
            }
          });
        });
      }
    }

    function turnOffReminders() {
      if (typeof Notification !== "undefined" && Notification.permission === "granted") {
        remindersEnabled = false;
        localStorage.setItem(`remindersEnabled_${profileId}`, "false");
        disableCount++;
        localStorage.setItem("disableCount", disableCount);
        document.getElementById("disable-count").textContent = disableCount;
        alert("Reminders have been turned off. Refresh the page to confirm or turn them back on.");
        document.getElementById("reminders").classList.add("hidden");
        document.getElementById("contact-card").classList.add("hidden");
        document.getElementById("selection-primary-card").classList.remove("hidden");
        navigationHistory = ["selection-primary-card"];
        updateReminderStatus();
      } else {
        alert("Notifications are already disabled or not supported.");
      }
    }

    function turnOnReminders() {
      if (typeof Notification !== "undefined" && Notification.permission !== "granted") {
        remindersEnabled = true;
        localStorage.setItem(`remindersEnabled_${profileId}`, "true");
        Notification.requestPermission().then(permission => {
          if (permission === "granted") {
            sendNotifications();
            alert("Reminders have been turned on and notifications sent.");
          } else {
            alert("Notifications are disabled. Please enable them in browser settings.");
            remindersEnabled = false;
            localStorage.setItem(`remindersEnabled_${profileId}`, "false");
          }
          updateReminderStatus();
        });
      } else if (typeof Notification !== "undefined" && Notification.permission === "granted") {
        remindersEnabled = true;
        localStorage.setItem(`remindersEnabled_${profileId}`, "true");
        sendNotifications();
        alert("Reminders have been turned on and notifications sent.");
        updateReminderStatus();
      } else {
        alert("This browser does not support notifications.");
      }
    }

    function updateReminderStatus() {
      const statusElement = document.getElementById("reminder-status");
      if (remindersEnabled && Notification.permission === "granted") {
        statusElement.textContent = "Reminders: ✅ ON";
      } else {
        statusElement.textContent = "Reminders: ❌ OFF";
      }
    }

    function goBack() {
      if (navigationHistory.length > 1) {
        navigationHistory.pop(); // Remove current page
        const previousCard = navigationHistory.pop(); // Get previous page
        const cards = ["selection-primary-card", "selection-power-card", "selection-seat-card", "selection-backrest-card", "contact-card", "reminders", "profile-card"];
        cards.forEach(card => document.getElementById(card).classList.add("hidden"));
        document.getElementById(previousCard).classList.remove("hidden");
        navigationHistory.push(previousCard); // Re-add previous page to history
        updateNavButtons();
      }
    }

    function goHome() {
      const cards = ["selection-primary-card", "selection-power-card", "selection-seat-card", "selection-backrest-card", "contact-card", "reminders"];
      cards.forEach(card => document.getElementById(card).classList.add("hidden"));
      document.getElementById("profile-card").classList.remove("hidden");
      navigationHistory = ["profile-card"];
      updateNavButtons();
    }

    function updateNavButtons() {
      const currentCard = ["selection-primary-card", "selection-power-card", "selection-seat-card", "selection-backrest-card", "contact-card", "reminders", "profile-card"].find(card => !document.getElementById(card).classList.contains("hidden"));
      document.querySelectorAll("#back-button").forEach(btn => btn.classList.toggle("hidden", navigationHistory.length <= 1));
      document.querySelectorAll("#return-to-home, #return-to-home-reminders").forEach(btn => btn.classList.remove("hidden"));
    }

    function adminLogin() {
      const code = prompt("Enter admin code:");
      if (code === "6009") {
        document.getElementById("admin-data").classList.remove("hidden");
      } else {
        alert("Incorrect code.");
      }
    }

    function updateAdminStats() {
      const mobilityBaseSorted = Object.entries(mobilityBaseCount).sort((a, b) => b[1] - a[1]).map(([key, value]) => `${key}: ${value}`).join(", ");
      const backrestSorted = Object.entries(backrestCount).sort((a, b) => b[1] - a[1]).map(([key, value]) => `${key}: ${value}`).join(", ");
      const seatSorted = Object.entries(seatCount).sort((a, b) => b[1] - a[1]).map(([key, value]) => `${key}: ${value}`).join(", ");
      document.getElementById("mobility-base-count").textContent = mobilityBaseSorted;
      document.getElementById("backrest-count").textContent = backrestSorted;
      document.getElementById("seat-count").textContent = seatSorted;
    }

    // Ensure DOM is fully loaded before adding event listeners and initializing
    document.addEventListener("DOMContentLoaded", () => {
      initializeProfile();

      const nextToPower = document.getElementById("next-to-power");
      const nextToSeat = document.getElementById("next-to-seat");
      const nextToBackrest = document.getElementById("next-to-backrest");
      const nextToContact = document.getElementById("next-to-contact");
      const submitContact = document.getElementById("submit-contact");
      const submitFinal = document.getElementById("submit-final");
      const turnOffRemindersBtn = document.getElementById("turn-off-reminders-profile");
      const turnOnRemindersBtn = document.getElementById("turn-on-reminders-profile");
      const backButtons = document.querySelectorAll("#back-button");
      const returnToHome = document.getElementById("return-to-home");
      const returnToHomeReminders = document.getElementById("return-to-home-reminders");

      backButtons.forEach(btn => btn.addEventListener("click", goBack));
      if (returnToHome) returnToHome.addEventListener("click", goHome);
      if (returnToHomeReminders) returnToHomeReminders.addEventListener("click", goHome);
      if (nextToPower) nextToPower.addEventListener("click", () => nextSection("selection-primary-card", "selection-power-card"));
      if (nextToSeat) nextToSeat.addEventListener("click", () => nextSection("selection-power-card", "selection-seat-card"));
      if (nextToBackrest) nextToBackrest.addEventListener("click", () => nextSection("selection-seat-card", "selection-backrest-card"));
      if (nextToContact) nextToContact.addEventListener("click", () => nextSection("selection-backrest-card", "contact-card"));
      if (submitContact) submitContact.addEventListener("click", () => { submitContact(); navigationHistory.push("reminders"); updateNavButtons(); });
      if (submitFinal) submitFinal.addEventListener("click", () => { submitReminders(); navigationHistory.push("profile-card"); updateNavButtons(); });
      if (turnOffRemindersBtn) turnOffRemindersBtn.addEventListener("click", turnOffReminders);
      if (turnOnRemindersBtn) turnOnRemindersBtn.addEventListener("click", turnOnReminders);
    });
  </script>
</body>
</html>
